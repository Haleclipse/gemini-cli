# 自动化和分类流程

本文档详细概述了我们用于管理和分类问题(Issues)和拉取请求(Pull Requests)的自动化流程。我们的目标是提供及时反馈，确保贡献能被高效审核和集成。了解这些自动化流程将帮助您作为贡献者了解预期内容，以及如何最好地与我们的仓库机器人交互。

## 指导原则：Issues 和 Pull Requests

首先也是最重要的，几乎每个拉取请求(PR)都应该链接到相应的问题(Issue)。问题描述"什么"和"为什么"(错误或功能)，而 PR 是"如何"(实现)。这种分离有助于我们跟踪工作、优先处理功能并保持清晰的历史背景。我们的自动化流程围绕这一原则构建。

---

## 详细的自动化工作流

以下是在我们仓库中运行的具体自动化工作流的详细分解。

### 1. 当您创建问题时：`自动问题分类`

这是您创建问题时首先交互的机器人。它的工作是执行初始分析并应用正确的标签。

- **工作流文件**：`.github/workflows/gemini-automated-issue-triage.yml`
- **运行时机**：问题创建或重新开启后立即运行
- **执行操作**：
  - 它使用 Gemini 模型根据详细的指导原则分析问题的标题和正文
  - **应用一个 `area/*` 标签**：将问题分类到项目的功能区域(例如，`area/ux`、`area/models`、`area/platform`)
  - **应用一个 `kind/*` 标签**：识别问题类型(例如，`kind/bug`、`kind/enhancement`、`kind/question`)
  - **应用一个 `priority/*` 标签**：根据描述的影响分配从 P0(关键)到 P3(低)的优先级
  - **可能应用 `status/need-information`**：如果问题缺少关键详细信息(如日志或复现步骤)，将标记为需要更多信息
  - **可能应用 `status/need-retesting`**：如果问题引用的 CLI 版本超过六个版本，将标记为需要在当前版本上重新测试
- **您应该做的**：
  - 尽可能完整地填写问题模板。您提供的详细信息越多，分类就越准确
  - 如果添加了 `status/need-information` 标签，请在评论中提供请求的详细信息

### 2. 当您开启拉取请求时：`持续集成(CI)`

此工作流确保所有更改在合并之前符合我们的质量标准。

- **工作流文件**：`.github/workflows/ci.yml`
- **运行时机**：在每次向拉取请求推送时
- **执行操作**：
  - **代码检查**：检查您的代码是否遵循我们项目的格式和样式规则
  - **测试**：在 macOS、Windows 和 Linux 以及多个 Node.js 版本上运行我们的完整自动化测试套件。这是 CI 流程中最耗时的部分
  - **发布覆盖率评论**：所有测试成功通过后，机器人将在您的 PR 上发布评论。此评论提供您的更改被测试覆盖程度的摘要
- **您应该做的**：
  - 确保所有 CI 检查通过。当一切成功时，您的提交旁边会出现绿色对勾标记 ✅
  - 如果检查失败(红色"X"❌)，点击失败检查旁边的"详细信息"链接查看日志，识别问题并推送修复

### 3. 拉取请求的持续分类：`PR 审计和标签同步`

此工作流定期运行，确保所有开放的 PR 都正确链接到问题并具有一致的标签。

- **工作流文件**：`.github/workflows/gemini-scheduled-pr-triage.yml`
- **运行时机**：每 15 分钟对所有开放的拉取请求运行
- **执行操作**：
  - **检查链接的问题**：机器人扫描您的 PR 描述，查找将其链接到问题的关键词(例如，`Fixes #123`、`Closes #456`)
  - **添加 `status/need-issue`**：如果未找到链接的问题，机器人将向您的 PR 添加 `status/need-issue` 标签。这是需要创建并链接问题的明确信号
  - **同步标签**：如果问题已链接，机器人确保 PR 的标签与问题的标签完全匹配。它将添加任何缺少的标签并删除不属于的标签，如果存在 `status/need-issue` 标签，它将删除该标签
- **您应该做的**：
  - **始终将您的 PR 链接到问题**。这是最重要的步骤。在您的 PR 描述中添加如 `Resolves #<issue-number>` 的行
  - 这将确保您的 PR 被正确分类并顺利通过审核过程

### 4. 问题的持续分类：`定期问题分类`

这是一个后备工作流，确保分类过程不会遗漏任何问题。

- **工作流文件**：`.github/workflows/gemini-scheduled-issue-triage.yml`
- **运行时机**：每小时对所有开放问题运行
- **执行操作**：
  - 它主动寻找完全没有标签或仍有 `status/need-triage` 标签的问题
  - 然后触发与初始分类机器人相同的强大基于 Gemini 的分析，以应用正确的标签
- **您应该做的**：
  - 您通常不需要做任何事情。此工作流是一个安全网，确保每个问题最终都被分类，即使初始分类失败

### 5. 发布自动化

此工作流处理 Gemini CLI 新版本的打包和发布过程。

- **工作流文件**：`.github/workflows/release.yml`
- **运行时机**：对于"夜间"发布按日程安排运行，对于官方补丁/小版本发布手动运行
- **执行操作**：
  - 自动构建项目，升级版本号，并将包发布到 npm
  - 在 GitHub 上创建相应的发布，包含生成的发布说明
- **您应该做的**：
  - 作为贡献者，您无需为此过程做任何事情。您可以确信，一旦您的 PR 合并到 `main` 分支，您的更改将包含在下一个夜间发布中

我们希望这个详细概述对您有帮助。如果您对我们的自动化或流程有任何疑问，请不要犹豫提问！